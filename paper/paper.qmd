---
title: "Prediction of US Election in 2024"
subtitle: "My subtitle if needed"
author: 
  - Xinqi Yue
  - Yawen Tan
  - Duanyi Su
thanks: "Code and data are available at: [https://github.com/xinqiyue/2024_US_Election_Prediction](https://github.com/xinqiyue/2024_US_Election_Prediction)."
date: today
date-format: long
abstract: "First sentence. Second sentence. Third sentence. Fourth sentence."
format: pdf
number-sections: true
bibliography: references.bib
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
```

```{r}
#| include: false
#| warning: false
#| message: false
# load data
president_polls_cleaned_data <- read.csv('../data/02-analysis_data/president_polls_cleaned_data.csv')
# transfer date to standard form
president_polls_cleaned_data$end_date <- ymd(president_polls_cleaned_data$end_date)
```


```{r}
base_plot <- ggplot(president_polls_cleaned_data, aes(x = end_date, y = pct, color = candidate_name)) +
  theme_classic() +
  labs(y = "Candidate Support (%)", x = "Date") 
#+  scale_x_date(date_labels = "%b %Y")  # 设置 x 轴只显示月份和年份

# 绘制候选人支持率的点图和光滑线
base_plot + 
  geom_point() + 
  geom_smooth(se = FALSE) + 
  theme(legend.position = "bottom")
```




```{r}
# plot graph of pct of two candidates in each state against time
ggplot(president_polls_cleaned_data, aes(x = end_date, y = pct
                                         #, color = state
                                         )
       ) +
  geom_point() +
  facet_wrap(~ candidate_name, scales = "free_y") +
  theme_minimal() +
  #theme(legend.position = "bottom") +
  labs(
    y = "pct",
    x = "end date",
    color = "state",
    title = "pct of Donald Trump and Kamala Harris in each states",
  )
```

# Introduction

Overview paragraph
As the United States prepares for the 2024 presidential election, the role of opinion polls in understanding voter preferences remains critical. Polls serve as indicators of public sentiment, offering insights into which candidates might have an advantage in the electoral race. This paper aims to predict the winner of the upcoming election by analyzing "poll-of-polls" data. 

Estimand paragraph

Results paragraph

Why it matters paragraph

Telegraphing paragraph: The remainder of this paper is structured as follows. @sec-data....






# Data {#sec-data}

## Overview
The dataset encompasses polling data focused on two candidates, Donald Trump and Kamala Harris. Data has been filtered to include only results from pollsters with a numeric grade above 2.5 to maintain quality and consistency. This selection allows us to focus on higher-rated sources, which may enhance the reliability of predictions. Each record includes information on the pollster, their grading, polling methodology, transparency score, and specific polling results for each candidate.

## Explanation of each variables
- **pollster**: The organization that conducted the poll, providing information on who gathered the data.
  
- **numeric grade**: A quality score assigned to the pollster, with higher values indicating greater reliability. Only pollsters with a score above 2.5 are included to enhance accuracy.

- **pollscore**: A specific rating of the individual poll, reflecting additional factors that impact the poll's quality and reliability.

- **methodology**: The method used by the pollster to conduct the poll, which may affect the reliability and interpretation of the results.

- **transparency score**: A measure of how openly the pollster reports their methodology and results. Higher scores suggest greater transparency and reliability.

- **state**: The U.S. state where the poll was conducted, which allows for state-by-state analysis and comparison of support levels.

- **start date**: The date the poll began, marking the beginning of data collection for that specific poll.

- **end date**: The date the poll concluded, marking the end of data collection for that specific poll.

- **sample size**: The number of respondents in the poll, indicating the scope and potential statistical reliability of the results.

- **population**: A general description of the population sampled (e.g., likely voters), providing context on who was surveyed.

- **population full**: Detailed information about the sample population, offering insights into demographic or eligibility characteristics.

- **hypothetical**: Indicates whether the poll was based on a hypothetical scenario, coded as a binary value.

- **party**: The political party affiliation of the respondent or the focus of the poll, when specified.

- **answer**: The poll outcome or response category (e.g., the candidate name or specific answer provided by respondents).

- **candidate_name**: The name of the candidate being polled, which in this data set focuses on Donald Trump and Kamala Harris.

- **pct**: The support percentage each candidate received in the poll, which serves as the outcome variable for analysis.


## Measurement
Key measurements in the dataset include each poll’s numeric_grade (a quality score for the pollster), pollscore (a specific rating per poll), and transparency_score. These indicators help assess and compare the reliability of the included poll results. Additionally, records contain information on sample_size, state, start_date, and end_date, capturing the timing and scope of each poll.

## Outcome variables
The primary outcome variable in this analysis is pct, representing each candidate’s support percentage in individual polls. Focusing on support levels for Trump and Harris enables us to evaluate current sentiment and ultimately predict the election outcome.

## Predictor variables
Predictor variables include pollster, numeric_grade, pollscore, transparency_score, state, sample_size, population, population_full, and methodology. These factors provide context for each poll’s results and help assess how factors such as sample size, polling method, and geographical scope may influence support percentages.



# Model

The goal of our modelling strategy is twofold. Firstly,...

Here we briefly describe the Bayesian analysis model used to investigate... Background details and diagnostics are included in [Appendix -@sec-model-details].

## Model set-up

Define $y_i$ as the number of seconds that the plane remained aloft. Then $\beta_i$ is the wing width and $\gamma_i$ is the wing length, both measured in millimeters.  

\begin{align} 
y_i|\mu_i, \sigma &\sim \mbox{Normal}(\mu_i, \sigma) \\
\mu_i &= \alpha + \beta_i + \gamma_i\\
\alpha &\sim \mbox{Normal}(0, 2.5) \\
\beta &\sim \mbox{Normal}(0, 2.5) \\
\gamma &\sim \mbox{Normal}(0, 2.5) \\
\sigma &\sim \mbox{Exponential}(1)
\end{align}

We run the model in R [@citeR] using the `rstanarm` package of @rstanarm. We use the default priors from `rstanarm`.


### Model justification

We expect a positive relationship between the size of the wings and time spent aloft. In particular...

We can use maths by including latex between dollar signs, for instance $\theta$.


# Results

Our results are summarized in @tbl-modelresults.

```{r}
#| echo: false
#| eval: true
#| warning: false
#| message: false

library(rstanarm)

first_model <-
  readRDS(file = here::here("models/first_model.rds"))
```

```{r}
#| echo: false
#| eval: true
#| label: tbl-modelresults
#| tbl-cap: "Explanatory models of flight time based on wing width and wing length"
#| warning: false

modelsummary::modelsummary(
  list(
    "First model" = first_model
  ),
  statistic = "mad",
  fmt = 2
)
```




# Discussion

## First discussion point {#sec-first-point}

If my paper were 10 pages, then should be be at least 2.5 pages. The discussion is a chance to show off what you know and what you learnt from all this. 

## Second discussion point

Please don't use these as sub-heading labels - change them to be what your point actually is.

## Third discussion point

## Weaknesses and next steps

Weaknesses and next steps should also be included.

\newpage

\appendix

# Appendix {-}


# Additional data details

# Model details {#sec-model-details}

## Posterior predictive check

In @fig-ppcheckandposteriorvsprior-1 we implement a posterior predictive check. This shows...

In @fig-ppcheckandposteriorvsprior-2 we compare the posterior with the prior. This shows... 

```{r}
#| eval: true
#| echo: false
#| message: false
#| warning: false
#| label: fig-ppcheckandposteriorvsprior
#| layout-ncol: 2
#| fig-cap: "Examining how the model fits, and is affected by, the data"
#| fig-subcap: ["Posterior prediction check", "Comparing the posterior with the prior"]

pp_check(first_model) +
  theme_classic() +
  theme(legend.position = "bottom")

posterior_vs_prior(first_model) +
  theme_minimal() +
  scale_color_brewer(palette = "Set1") +
  theme(legend.position = "bottom") +
  coord_flip()
```

## Diagnostics

@fig-stanareyouokay-1 is a trace plot. It shows... This suggests...

@fig-stanareyouokay-2 is a Rhat plot. It shows... This suggests...

```{r}
#| echo: false
#| eval: true
#| message: false
#| warning: false
#| label: fig-stanareyouokay
#| fig-cap: "Checking the convergence of the MCMC algorithm"
#| fig-subcap: ["Trace plot", "Rhat plot"]
#| layout-ncol: 2

plot(first_model, "trace")

plot(first_model, "rhat")
```



\newpage


# References


